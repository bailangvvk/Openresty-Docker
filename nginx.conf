worker_processes  1;

events {
    worker_connections 1024;
}

http {
    init_by_lua_block {
        local port = os.getenv("NGINX_PORT") or "8080"
        ngx.shared.my_config:set("port", port)
    }

    server {
        listen 0;  # 用 Lua 设置实际监听端口
        set_by_lua_block $port {
            return ngx.shared.my_config:get("port")
        }
        listen $port;

        location / {
            default_type text/plain;
            content_by_lua_block {
                ngx.say("Hello from dynamic OpenResty!")
            }
        }
    }
}
